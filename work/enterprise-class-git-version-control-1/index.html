<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>化繁为简的企业级 Git 管理实践（一）：多分支子模块依赖管理 | HaHack</title>
  <meta name="author" content="wzpan">
  
  <meta name="description" content="介绍面向复杂工程的简单化 Git 分支依赖管理方案。我们对子模块的使用进行了简化，避免了由于漏提交子模块 commit id 或子模块代码导致无法更新或更新错误的情况。">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="化繁为简的企业级 Git 管理实践（一）：多分支子模块依赖管理"/>
  <meta property="og:site_name" content="HaHack"/>

  
    <meta property="og:image" content="undefined"/>
  

  
    <link rel="alternative" href="//atom.xml" title="HaHack" type="application/atom+xml">
  
  
    <link href="/favicon.png" rel="icon">
  

  <!-- CSS -->
  <link rel="stylesheet" id="theme" href="/css/themes/cerulean.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight-default.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/bubble.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/sidenav.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/article.css" media="screen" type="text/css">
  <!-- <link rel="stylesheet" href="/css/comment.css" media="screen" type="text/css"> -->
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.9/es5-shim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/es5-shim/4.5.7/es5-sham.min.js"></script>
    <![endif]-->

  <script src="//hahack-1253537070.file.myqcloud.com/images/blog/js/jquery-2.0.3.min.js"></script>
  <script src="//hahack-1253537070.file.myqcloud.com/images/blog/js/jquery.pjax.min.js"></script>
  <script src="//hahack-1253537070.file.myqcloud.com/images/blog/js/pace.min.js"></script>
  <script src="//hahack-1253537070.file.myqcloud.com/images/blog/js/theme.js"></script>
  <script src="//hahack-1253537070.file.myqcloud.com/images/blog/js/search.js"></script>
  
    
    <link rel="stylesheet" href="/css/gitalk.css">
    <script src="//hahack-1253537070.file.myqcloud.com/images/blog/js/gitalk.min.js"></script>
    
  <script type="text/javascript">
    $(document).ready(function() {
      $(document).pjax('a[target!=_blank][rel!=gallery]', '.pjax', {fragment:'.pjax', timeout:8000});
    });

    $(document).on('pjax:send', function() {
	  Pace.restart();
    })
    $(document).on('pjax:complete', function() {
       Pace.stop();
        
       var search_path = "search.xml";
	   if (search_path.length == 0) {
	 	search_path = "search.xml";
	   }
	   var path = '/' + search_path;
      searchFunc(path, 'local-search-input', 'local-search-result');

       $('[data-spy="affix"]').each(function () {
          var $spy = $(this)
          , data = $spy.data()
          data.offset = data.offset || {}
          data.offsetBottom && (data.offset.bottom = data.offsetBottom)
          data.offsetTop && (data.offset.top = data.offsetTop)
          $spy.affix(data)
       });

    })
    $(document).on({'pjax:end': function() {
      $.getScript("//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML", function() { 
            MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
                tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
                TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
                messageStyle: "none"
            });

            var math = document.getElementsByClassName("pjax")[0];
            MathJax.Hub.Queue(["Typeset",MathJax.Hub,math]);
            
        });
        $.getScript("//hahack-1253537070.file.myqcloud.com/images/blog/js/gallery.js");
        if ($('#gitalk-container').length > 0) {
            var gitalk = new Gitalk({
                clientID: '19f93019e0c0b8fdc4b3',
                clientSecret: '00ca18ff55f2b4f0f33af3fb90ff524e7acd1032',
                id: undefined != undefined ? 'undefined' : window.location.pathname,
                repo: 'wzpan.github.io',
                owner: 'wzpan',
                admin: 'wzpan',
                proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token',
                title: '化繁为简的企业级 Git 管理实践（一）：多分支子模块依赖管理'
            })
            gitalk.render('gitalk-container');
        }
      }
    })
  </script>
  <!-- analytics -->
  



<meta name="generator" content="Hexo 5.4.0"></head>

 <body data-spy="scroll" data-target=".wiki .toc">
  <nav id="main-nav" class="navbar navbar-inverse navbar-default navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
	<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
       <a class="navbar-brand" href="/">HaHack</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archive" title="所有文章存档">
			  <i class="fas fa-archive"></i>Archive
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="所有文章分类.">
			  <i class="fa fa-folder"></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="所有文章标签.">
			  <i class="fa fa-tags"></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/wiki" title="我的笔记库">
			  <i class="fa fa-tasks"></i>wiki
			</a>
		  </li>
		  
		</ul>
        <ul class="nav navbar-nav navright">
          <li class="dropdown works">
          <a href="#" title="更换主题" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><i class="fa fa-palette"></i></a>
          <ul class="dropdown-menu">
            
                   <li role="presentation"><a role="menuitem" tabindex="-1" href="#" id="freemind-cerulean" title="更换颜色主题为cerulean"><span style="width:1em; height:1em; margin-top: 2px; margin-right: 5px; float: left; display: block; background:#0B4C8D"></span>cerulean</a></li> 
			
                   <li role="presentation"><a role="menuitem" tabindex="-1" href="#" id="freemind-cyborg" title="更换颜色主题为cyborg"><span style="width:1em; height:1em; margin-top: 2px; margin-right: 5px; float: left; display: block; background:#272B30"></span>cyborg</a></li> 
			
                   <li role="presentation"><a role="menuitem" tabindex="-1" href="#" id="freemind-paper" title="更换颜色主题为paper"><span style="width:1em; height:1em; margin-top: 2px; margin-right: 5px; float: left; display: block; background:#2B97F0"></span>paper</a></li> 
			
                   <li role="presentation"><a role="menuitem" tabindex="-1" href="#" id="freemind-flatly" title="更换颜色主题为flatly"><span style="width:1em; height:1em; margin-top: 2px; margin-right: 5px; float: left; display: block; background:#28BB9C"></span>flatly</a></li> 
			
                   <li role="presentation"><a role="menuitem" tabindex="-1" href="#" id="freemind-journal" title="更换颜色主题为journal"><span style="width:1em; height:1em; margin-top: 2px; margin-right: 5px; float: left; display: block; background:#E96967"></span>journal</a></li> 
			
                   <li role="presentation"><a role="menuitem" tabindex="-1" href="#" id="freemind-simplex" title="更换颜色主题为simplex"><span style="width:1em; height:1em; margin-top: 2px; margin-right: 5px; float: left; display: block; background:#D7261E"></span>simplex</a></li> 
			
                   <li role="presentation"><a role="menuitem" tabindex="-1" href="#" id="freemind-spacelab" title="更换颜色主题为spacelab"><span style="width:1em; height:1em; margin-top: 2px; margin-right: 5px; float: left; display: block; background:#507DAC"></span>spacelab</a></li> 
			
          </ul>
          </li>
          <li class="dropdown works">
          <a href="#" title="作品集" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Works <span class="caret"></span></a>
          <ul class="dropdown-menu">
            
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="http://github.com/wzpan/wukong-robot" title="wukong-robot 是一个简单、灵活、优雅的中文语音对话机器人。"><i class="fab fa-github"></i>wukong-robot</a></li>
			
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="http://github.com/dingdang-robot/dingdang-robot" title="叮当是一款可以工作在 Raspberry Pi 上的中文语音对话机器人/智能音箱项目。"><i class="fab fa-github"></i>dingdang-robot</a></li>
			
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="http://github.com/wzpan/comment.js" title="纯JS实现的静态站点评论系统，使用 Github/OSChina 作为 backend。"><i class="fab fa-github"></i>comment.js</a></li>
			
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="http://github.com/wzpan/qtevm" title="首个完整的 C++ 开源实现，能同时放大动作变化和颜色变化"><i class="fab fa-github"></i>QtEVM</a></li>
			
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="https://github.com/wzpan/wzpan.github.io/wiki/hexo-series" title="为 Hexo 写的一系列主题/工具/插件"><i class="fab fa-github"></i>hexo-series</a></li>
			
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="https://github.com/scnu/scnuthesis" title="符合华南师范大学硕士/博士学位论文格式要求的LaTeX模板。"><i class="fab fa-github"></i>SCNUThesis</a></li>
			
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="https://github.com/wzpan/wzpan.github.io/wiki/slides" title="一些幻灯片作品"><i class="fab fa-github"></i>Slides</a></li>
			
				   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="http://www.hahack.com/codes/fcevm/" title="硕士毕业论文"><i class="fab fa-github"></i>Dissertation</a></li>
			
            <li role="separator" class="divider"></li>
            
                   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="https://ke.qq.com/course/list/python%20next%20潘伟洲" title="Python 从入门到实践系列"><i class="fas fa-video"></i>Python</a></li> 
			
                   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="https://ke.qq.com/course/350627" title="使用Cocos Creator开发微信小游戏《2048》"><i class="fas fa-video"></i>2048</a></li> 
			
                   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="https://ke.qq.com/course/326820" title="微信小游戏入门与实战"><i class="fas fa-video"></i>minigame</a></li> 
			
                   <li role="presentation"><a role="menuitem" tabindex="-1" target="_blank" href="https://ke.qq.com/course/471888?_bid=167&_wv=3&term_id=100565039&taid=4061608838378320" title="微信小游戏入门与实战"><i class="fas fa-video"></i>IT大咖说</a></li> 
			
          </ul>
          </li>
          <li class="dropdown works">
            <a href="#" title="订阅本站" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Subscribe <span class="caret"></span></a>
            <ul class="dropdown-menu">
              
			    <li role="presentation"><a role="menuitem" tabindex="-1"  href="/atom.xml"  title="使用 RSS 阅读器订阅 HaHack"  ><i class="fa fa-rss-square"></i>RSS</a></li>
			  
			    <li role="presentation"><a role="menuitem" tabindex="-1"  title="订阅 HaHack 的公众平台"  data-toggle="modal" data-target="#wechat-modal" ><i class="fa fa-qrcode"></i>WeChat</a></li>
			  
			    <li role="presentation"><a role="menuitem" tabindex="-1"  target="_blank" rel="noopener" href="http://toutiao.io/u/147640"  title=""  ><i class="fa fa-align-justify"></i>Toutiao</a></li>
			   
            </ul>
          </li>
          
				<li><a data-pjax href="/about" title="关于我"><i class="fa fa-user"></i>About</a></li>				   				
   	  	  
        </ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content pjax">
      


	
		<div class="page-header page-header-inverse ">		
			<h1 class="title title-inverse "> 化繁为简的企业级 Git 管理实践（一）：多分支子模块依赖管理</h1>
		</div>		
	






<div class="row post">
	<!-- cols -->
	
	<div id="top_meta"></div>
	<div class="col-md-9">
	

	<!-- content -->
	<div class="mypage">		
	  
		 <div class="alert alert-success description">
			<i class="fa fa-info-circle"></i> <p>介绍面向复杂工程的简单化 Git 分支依赖管理方案。我们对子模块的使用进行了简化，避免了由于漏提交子模块 commit id 或子模块代码导致无法更新或更新错误的情况。</p>
			
		 </div> <!-- alert -->
	  		

	  <h2 id="需求描述">需求描述</h2>
<p>我们尝试使用 Git 来维护一个项目的代码。这个项目的结构比较复杂：</p>
<ul>
<li>项目包含由多个子模块，每个子模块是一个独立的 Git 仓库，子模块还允许继续嵌套包含子模块。 例如，主工程依赖 common、framework、react_native 等多个子模块，而 react_native 子模块又依赖 node_modules、HFCommon、HFModules 等多个嵌套子模块。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[-] app_android&#x2F;</span><br><span class="line"> |-[+] HFUIKit</span><br><span class="line"> |-[+] channel</span><br><span class="line"> |-[+] common</span><br><span class="line"> |-[+] framework</span><br><span class="line"> |-[+] hybrid</span><br><span class="line"> |-[+] messagecenter</span><br><span class="line"> |-[-] react_native</span><br><span class="line">    |-[+] HFCommon</span><br><span class="line">    |-[+] HFModules</span><br><span class="line">    |-[+] node_modules</span><br></pre></td></tr></table></figure>
<ul>
<li>主工程和子模块允许存在多个分支，且相互之间有依赖关系。例如，主工程的 jilin 分支同时依赖 common 子模块的 master 分支，以及 framework 子模块的 jilin 分支。</li>
</ul>
<span id="more"></span>
<h2 id="Git-submodule-的问题">Git submodule 的问题</h2>
<p>Git 提供了 submodule 来支持子模块的需求，使用它可以很方便的将多个独立仓库包含到同一个主工程中：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git init</span><br><span class="line">$ git submodule add http://xxx.xxx/common.git</span><br><span class="line">$ git submodule add http://xxx.xxx/framework.git</span><br></pre></td></tr></table></figure>
<p>Git submodule 还支持嵌套添加子模块：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git submodule add http://xxx.xxx/react_native.git</span><br><span class="line">$ <span class="built_in">cd</span> react_native</span><br><span class="line">$ git submodule add http://xxx.xxx/HFCommon.git</span><br><span class="line">$ git submodule add http://xxx.xxx/HFModules.git</span><br><span class="line">$ git submodule add http://xxx.xxx/node_modules.git</span><br></pre></td></tr></table></figure>
<p>通过子模块，这些子模块既可以各自独立的修改和提交代码，又可以将改动作用到依赖它的父工程。这听起来是个很棒的特性，然而 Git submodule 也存在着一些让人抓狂的坑。</p>
<p>首先，主工程并不直接跟踪子模块的代码，而仅仅只跟踪子模块的 commit id 的改动。在执行 <code>git submodule update</code> 更新子模块代码时，Git 就是根据主工程所维护的 commit id 来更新子模块到指定状态的。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2$ git diff react_native </span><br><span class="line">diff --git a/react_native b/react_native</span><br><span class="line">index 3a9c5b1..ad68a28 160000</span><br><span class="line">--- a/react_native</span><br><span class="line">+++ b/react_native</span><br><span class="line">@@ -1 +1 @@</span><br><span class="line">-Subproject commit 3a9c5b14c45b199e2e6863d2b6da22dabc2a54f5</span><br><span class="line">+Subproject commit ad68a28c13d4196df531c7df8523d07358288297</span><br><span class="line">(END)</span><br></pre></td></tr></table></figure>
<p>因此，如果你只在子模块中修改并提交了代码，而没有到主工程上面再把子模块的 commit id 提交一下，其他人拉取工程代码的时候会发现子模块的代码依然停留在老的 commit id 所指向的状态。对于嵌套子模块，这种工作尤为繁琐，提交代码后要逐层往上提交 commit id ，否则其他人无法正确更新代码。</p>
<p>其次，如前面所说，使用 <code>git submodule update</code> 更新子模块后，子模块将被切换到一个指向父工程维护的 commit id 所指定的游离状态：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2$ git submodule update react_native</span><br><span class="line">bash-3.2$ <span class="built_in">cd</span> react_native</span><br><span class="line">bash-3.2$ git branch</span><br><span class="line">* (detached from 3a9c5b1)</span><br><span class="line">  master</span><br><span class="line">  jilin</span><br><span class="line">  TaiShan</span><br></pre></td></tr></table></figure>
<p>一旦代码处于游离分支，你就要时刻警惕在游离分支上的提交有没有即时合并到非游离分支上。如果你直接在游离分支上开发并提交了代码，之后在父工程里再次 <code>git submodule update</code> ，你所有未合并的提交都会丢失！</p>
<p>最后还有一个非常麻烦，但也极容易出现的问题：如果团队里有人只提交了主工程该子模块的 commit id ，却忘了进入该模块提交模块真正的代码，那么当推送到中央仓库之后，其他人就会因为找不到与该 commit id 对应的代码而无法正确更新代码：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">bash-3.2$ git submodule update</span><br><span class="line">error: pathspec <span class="string">&#x27;ad68a28c13d4196df531c7df8523d07358288297&#x27;</span> did not match any file(s) known to git.</span><br><span class="line">Did you forget to <span class="string">&#x27;git add&#x27;</span>?</span><br><span class="line">Unable to checkout <span class="string">&#x27;ad68a28c13d4196df531c7df8523d07358288297&#x27;</span> <span class="keyword">in</span> submodule path <span class="string">&#x27;react_native&#x27;</span></span><br></pre></td></tr></table></figure>
<p>对于熟练的用户，这些坑自然可以轻松越过。但考虑到团队里大都是 Git 新手，我们发现子模块的引入对他们造成了很大的负担，频繁出现子模块代码没有更新到最新状态，或者更新出错的情况。</p>
<h2 id="简单解决方案">简单解决方案</h2>
<p>经过考虑，我们决定对子模块的使用做些简化：</p>
<ol>
<li>所有子模块不再根据父工程的 commit id 更新代码，而是直接更新到主工程所依赖的分支的最新一次提交；</li>
<li>由于 commit id 不再用来更新代码，因此可以禁止直接提交子模块的 commit id ，避免出现只提交子模块 commit id 而忘记提交子模块代码的情况。</li>
</ol>
<h3 id="造个轮子：fmanager">造个轮子：fmanager</h3>
<p>为了达到第一个目的，我们自己写了个专用的管理工具 fmanager 。目前它一共支持如下几个功能，并且在不断扩展中：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fmanager pull      <span class="comment">#更新当前分支的主工程，并将每个子模块的代码更新到指定分支的最新状态。</span></span><br><span class="line">fmanager update    <span class="comment"># ./fmanager pull 的别名</span></span><br><span class="line">fmanager checkout &lt;分支名&gt; <span class="comment"># 切换到某个主工程分支，同时完成子模块的代码切换。</span></span><br><span class="line">fmanager submodule update &lt;模块名列表&gt; <span class="comment"># 更新指定子模块的代码到所处分支的最新状态。</span></span><br><span class="line">fmanager showbranch <span class="comment"># 查看当前主工程和所有子模块的所属分支。</span></span><br><span class="line">fmanager status <span class="comment"># 查看当前主工程和所有子模块的修改状态。</span></span><br><span class="line">fmanager <span class="built_in">log</span> <span class="comment"># 查看当前主工程和所有子模块的当前分支/标签和最新提交。</span></span><br><span class="line">fmanager cherry-pick &lt;commit id&gt; &lt;分支列表&gt; cherry-pick 某个 commit id 到分支列表。</span><br><span class="line">fmanager cherry-push &lt;commit id&gt; &lt;分支列表&gt; cherry-pick 某个 commit id 到分支列表，并推送这些分支。</span><br></pre></td></tr></table></figure>
<p>这个工具直接内置在主工程的根路径，并且接受一个 json 格式的配置文件 modules.json ，该配置文件大概长这样：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;sub&quot;</span>: &#123;        </span><br><span class="line">        <span class="attr">&quot;app&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;master_dev&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;common&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;master_dev&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;fmall&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;master&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;framework&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;jilin&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;fund&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;master_dev&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;hybrid&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;master_dev&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;messagecenter&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;master&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;property&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;master&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;safetykeyboardnew&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;master&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;scores&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;master&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;thirdparty&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;master_dev&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;react_native&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;jilin&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;react_native/HFModules&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;jilin&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;react_native/HFCommon&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;master_dev&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;react_native/node_modules&quot;</span>: &#123;<span class="attr">&quot;branch&quot;</span>: <span class="string">&quot;master&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>不同的主工程分支，modules.json 配置文件的内容允许不同，且每个模块都允许指定不同分支。对于嵌套子模块，我们通过加上父模块前缀来做标识。</p>
<p>当使用 fmanager 切换分支时，fmanager 将首先完成主工程的分支切换，然后读入该分支下的 modules.json ，再根据 modules.json 的配置逐个切换到各自模块的指定分支。</p>
<p>使用 fmanager 更新工程和切换分支相似，只是顺便完成了子模块的 git pull 操作。</p>
<p>这样的子模块管理策略看起来有点“激进”：永远使用分支最新的代码状态。为了保证稳定性，我们还支持在 modules.json 中使用 tag ：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;sub&quot;</span>: &#123;        </span><br><span class="line">        <span class="attr">&quot;app&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;common&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;fmall&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;framework&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;jilin-2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;fund&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;hybrid&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;messagecenter&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;property&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;safetykeyboardnew&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;scores&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;thirdparty&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;react_native&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;jilin-2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;react_native/HFModules&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;jilin-2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;react_native/HFCommon&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;2.0.1&quot;</span>&#125;,</span><br><span class="line">        <span class="attr">&quot;react_native/node_modules&quot;</span>: &#123;<span class="attr">&quot;tag&quot;</span>: <span class="string">&quot;2.0.1&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在项目后期，可以通过引用标签来保持整个工程的稳定性。同时，负责打包的机器每次打包时，都会顺便执行 <code>fmanager log</code> 产出一份包含当前所有子模块所处分支和最新一次 commit 的记录，方便追查问题。</p>
<h3 id="加个钩子：pre-commit">加个钩子：pre-commit</h3>
<p>要达到第二个目的，可以通过编写本地钩子 pre-commit 来实现。该钩子可以用来在 commit 前进行一些检查工作，并拒绝一些不合法的提交。针对我们的需求，可以写一个脚本检查提交中是否包含 commit id 的修改，如果有，就先重置那些修改再提交剩下的内容。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys,os,io,subprocess,json,re</span><br><span class="line"></span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">error_color = <span class="string">&quot;\033[31m&quot;</span></span><br><span class="line">warning_color = <span class="string">&quot;\033[33m&quot;</span></span><br><span class="line">normal_color = <span class="string">&quot;\033[0m&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getRootPath</span>():</span></span><br><span class="line">    <span class="comment"># 找到工程根目录</span></span><br><span class="line">    git_path = <span class="string">&quot;.git&quot;</span></span><br><span class="line">    pwd = os.getcwd()</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> os.path.exists(os.path.join(pwd, git_path)) <span class="keyword">and</span> os.path.isdir(os.path.join(pwd, git_path)):</span><br><span class="line">            <span class="keyword">return</span> os.path.abspath(pwd)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> (os.path.exists(os.path.join(pwd, <span class="string">&quot;../&quot;</span>))):</span><br><span class="line">                pwd = os.path.join(pwd, <span class="string">&quot;../&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSubmoduleNameAndPath</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;获取子模块信息&#x27;&#x27;&#x27;</span></span><br><span class="line">    root_path = getRootPath()</span><br><span class="line">    <span class="keyword">if</span> root_path != <span class="literal">None</span>:</span><br><span class="line">        output = subprocess.Popen([<span class="string">&#x27;git submodule --quiet foreach \&#x27;echo $toplevel/$path\&#x27;&#x27;</span>], stdout=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line">        oc = output.communicate() <span class="comment">#取出output中的字符串</span></span><br><span class="line">        submodule_dict = &#123;&#125;</span><br><span class="line">        <span class="keyword">for</span> element <span class="keyword">in</span> oc:</span><br><span class="line">            <span class="keyword">if</span> element != <span class="literal">None</span>:</span><br><span class="line">                sb_list = element.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">                <span class="keyword">for</span> elem <span class="keyword">in</span> sb_list:</span><br><span class="line">                    <span class="keyword">if</span> (elem != <span class="string">&quot;&quot;</span>):</span><br><span class="line">                        path = elem.strip()</span><br><span class="line">                        name = path.replace(root_path+<span class="string">&quot;/&quot;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">                        submodule_dict[name] = path</span><br><span class="line">        <span class="keyword">return</span> submodule_dict</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(warning_color)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">警告：检测到当前工程不是 .git 工程，文件目录可能已经损坏！</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">        <span class="built_in">print</span>(normal_color)</span><br><span class="line">        os.chdir(pwd)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkSubModule</span>():</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;防止提交子模块的 commit id&#x27;&#x27;&#x27;</span></span><br><span class="line">    pwd = os.getcwd()</span><br><span class="line">    submodule_dict = getSubmoduleNameAndPath()</span><br><span class="line">    <span class="comment"># 判断每个子模块是否修改了commit id</span></span><br><span class="line">    <span class="keyword">for</span> module_name, module_path <span class="keyword">in</span> submodule_dict.items():</span><br><span class="line">        os.chdir(os.path.join(module_path, <span class="string">&quot;..&quot;</span>))</span><br><span class="line">        module_basepath = os.path.basename(module_path)</span><br><span class="line">        output = subprocess.Popen([<span class="string">&#x27;git diff --cached &#x27;</span> + module_basepath], stdout=subprocess.PIPE, shell=<span class="literal">True</span>)</span><br><span class="line">        oc = output.communicate()[<span class="number">0</span>]</span><br><span class="line">        <span class="comment"># 判断是否提交了 commit id 修改</span></span><br><span class="line">        <span class="keyword">if</span> oc.find(<span class="string">&quot;-Subproject commit&quot;</span>) &gt;= <span class="number">0</span> <span class="keyword">and</span> oc.find(<span class="string">&quot;+Subproject commit&quot;</span>) &gt;= <span class="number">0</span>:</span><br><span class="line">            <span class="built_in">print</span>(warning_color)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">检查到子模块 %s 提交了 commit id，</span></span><br><span class="line"><span class="string">我们强烈建议**不要**提交子模块的 commit id 改动！该 commit id 将被跳过提交。</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span> % module_name)</span><br><span class="line">            <span class="built_in">print</span>(normal_color)</span><br><span class="line">            res = subprocess.call([<span class="string">&#x27;git&#x27;</span>, <span class="string">&#x27;reset&#x27;</span>, <span class="string">&#x27;HEAD&#x27;</span>, module_basepath])</span><br><span class="line">            <span class="keyword">if</span> res == <span class="number">0</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;子模块 &quot;</span> + module_name + <span class="string">&quot; 的 commit id 重置成功！&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(error_color)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;子模块 &quot;</span> + module_name + <span class="string">&quot; 的 commit id 重置失败！&quot;</span>)</span><br><span class="line">                <span class="built_in">print</span>(normal_color)</span><br><span class="line">                os.chdir(pwd)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    os.chdir(pwd)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> checkSubModule():</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>
<p>钩子编写完，还得解决安装问题。所谓“安装”，即是将 pre-commit 复制到根目录中的 .git/hooks 目录中，并确保可执行。听起来好像很简单，实则不然：</p>
<ol>
<li>.git 里的内容并不会随仓库一同提交。需要另外想其他办法让团队其他人“上钩”，并保持钩子的同步。</li>
<li>父工程的钩子不会被继承到子模块，也就是说，如果你希望一个钩子在父工程和多个子模块中用到，那你需要为每个仓库都添加一次钩子。</li>
</ol>
<p>fmanager 帮我们解决了第一个问题，由于我们用自己造的 fmanager 来更新工程代码，因此可以让 fmanager 在更新的时候自动完成钩子的安装。</p>
<p>而通过观察 .git 的文件结构，我发现每个子模块在 .git/modules 中各自拥有一个专属的数据目录。这个数据目录下也有一个 hooks 目录，该子模块的钩子就应该安装到这里。
如果有嵌套子模块，父模块的数据目录下还会有 modules 目录，并且可以一直这么嵌套下去。</p>
<p>解决这两个问题后，钩子顺利安装到了每个团队成员的仓库中，并且还能时刻保持同步。一旦有人试图提交 commit id 的修改，就会出现如下的错误：</p>
<p>
      <figure>
        <img src="//hahack-1253537070.file.myqcloud.com/images/blog/images/enterprise-class-git-version-control-1/pre-commit.png" alt="利用 pre-commit 钩子实现跳过 commit id 提交" />
        <figcaption>利用 pre-commit 钩子实现跳过 commit id 提交</figcaption>
      </figure>
    </p>
<p>而其他内容的修改依然可以正常提交。</p>
<p>pre-commit 钩子非常有用，我们陆续又添加了诸如代码风格检查、json 合法性检查、commit 邮箱合法性检查等测试。</p>
<h2 id="总结">总结</h2>
<p>通过本文的方法，我们对子模块的使用进行了简化，避免了由于漏提交子模块 commit id 或子模块代码导致无法更新或更新错误的情况。这么做看起来好像完全抛弃了子模块的 commit id ，但在下面的文章中，我将介绍一种自动更新子模块 commit id 的方法，该方法将利用 commit id 自动触发针对子模块的持续集成测试。</p>
	  
	</div>

	<!-- recommended posts -->
	

	<div>
  	<center>
	<div class="pagination">
<ul class="pagination">
	 
				
    	<li class="prev"><a href="/work/enterprise-class-git-version-control-2/" class="alignleft prev"><i class="fa fa-arrow-circle-o-left"></i>Prev</a></li>
  		

        <li><a href="/archive"><i class="fa fa-archive"></i>Archive</a></li>

		
		   <li class="next"><a href="/codes/learn-react-native-for-android-02/" class="alignright next">Next<i class="fa fa-arrow-circle-o-right"></i></a></li>         
        
	
</ul>
</div>

    </center>
	</div>

    <!-- share -->
    
        <!-- 
    <div class="bdsharebuttonbox">
        <a href="#" class="bds_more" data-cmd="more"></a>
        <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
        <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
        <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
        <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
        <a href="#" class="bds_linkedin" data-cmd="linkedin" title="分享到linkedin"></a>
        <a href="#" class="bds_evernotecn" data-cmd="evernotecn" title="分享到印象笔记"></a>
        <a href="#" class="bds_youdao" data-cmd="youdao" title="分享到有道云笔记"></a>
        <a href="#" class="bds_copy" data-cmd="copy" title="分享到复制网址"></a>
    </div>
    <script>
        window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"24"},"share":{}};
        with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='https://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
    </script>

 -->
        <!-- 
 -->
    
	
	<!-- comment -->
	
<section id="comment">
  <h2 class="title">Comments</h2>
  
  <div id="gitalk-container"></div>
  <script type="text/javascript">
    if ($('#gt-container').length <= 0) {
    var gitalk = new Gitalk({
        clientID: '19f93019e0c0b8fdc4b3',
        clientSecret: '00ca18ff55f2b4f0f33af3fb90ff524e7acd1032',
        id: undefined != undefined ? 'undefined' : window.location.pathname,
        repo: 'wzpan.github.io',
        owner: 'wzpan',
        admin: 'wzpan',
        proxy: 'https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token',
        title: '化繁为简的企业级 Git 管理实践（一）：多分支子模块依赖管理'
    })
    gitalk.render('gitalk-container');
    }
  </script>
  
</section>


	</div> <!-- col-md-9/col-md-12 -->
		
	
	<div id="side_meta">
		<div class="col-md-3" id="post_meta"> 

    <a href='https://github.com/wzpan/hexo-blog/edit/master/source/_posts/enterprise-class-git-version-control-1.md' target='_blank'><i class="fa fa-edit"></i> edit on Github</a>

	<!-- date -->
	
	<div class="meta-widget">
	<i class="fa fa-clock-o"></i>
	2016-04-13 
	</div>
	

	<!-- categories -->
    
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#categorys"><i class="fa fa-folder"></i></a>	
    <ul id="categorys" class="tag_box list-unstyled collapse in">
          
  <li>
    <li><a href="/categories/work/">work<span>7</span></a></li>
  </li>

    </ul>
	</div>
	

	<!-- tags -->
	
	<div class="meta-widget">
	<a data-toggle="collapse" data-target="#tags"><i class="fa fa-tags"></i></a>		  
    <ul id="tags" class="tag_box list-unstyled collapse in">	  
	    
  <li><a href="/tags/Git/">Git<span>5</span></a></li> <li><a href="/tags/Python/">Python<span>3</span></a></li>
    </ul>
	</div>
	

	<!-- toc -->
	<div class="meta-widget meta-toc" data-spy="affix" data-offset-top="400">
	
	   <a data-toggle="collapse" data-target="#toc"><i class="fa fa-bars"></i></a>
	   <div id="toc" class="toc collapse in">
			<ol class="toc-article"><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E9%9C%80%E6%B1%82%E6%8F%8F%E8%BF%B0"><span class="toc-article-text">需求描述</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#Git-submodule-%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-article-text">Git submodule 的问题</span></a></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E7%AE%80%E5%8D%95%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-article-text">简单解决方案</span></a><ol class="toc-article-child"><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E9%80%A0%E4%B8%AA%E8%BD%AE%E5%AD%90%EF%BC%9Afmanager"><span class="toc-article-text">造个轮子：fmanager</span></a></li><li class="toc-article-item toc-article-level-3"><a class="toc-article-link" href="#%E5%8A%A0%E4%B8%AA%E9%92%A9%E5%AD%90%EF%BC%9Apre-commit"><span class="toc-article-text">加个钩子：pre-commit</span></a></li></ol></li><li class="toc-article-item toc-article-level-2"><a class="toc-article-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-article-text">总结</span></a></li></ol>
		</div>
	
	</div>
	
    <hr>
	
</div><!-- col-md-3 -->

	</div>
		

</div><!-- row -->



	</div>
  </div>
  <div class="container-narrow">
    
    
    
    
          <div class="modal fade" id="wechat-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
            <div class="modal-dialog" role="document">
               <div class="modal-body">
                 <img src='https://hahack-1253537070.cos.ap-chengdu.myqcloud.com/images/blog/images/qrcode.jpg'/>
              </div>
            </div>
          </div>
		
    
    
    
  <footer> <p>
  &copy; 2021 wzpan
  
    <small>
     <a rel="license noopener" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/3.0/deed.zh"><img title="知识共享许可协议" style="border-width: 0px; vertical-align: middle; display: inline; " src="/images/license.png"></a>
    </small>
</p>
 </footer>
  </div> <!-- container-narrow -->
  
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"], linebreaks: { automatic:true }, EqnChunk: (MathJax.Hub.Browser.isMobile ? 10 : 50) },
        tex2jax: { inlineMath: [ ["$", "$"], ["\\(","\\)"] ], processEscapes: true, ignoreClass: "tex2jax_ignore|dno",skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']},
        TeX: {  noUndefined: { attributes: { mathcolor: "red", mathbackground: "#FFEEEE", mathsize: "90%" } }, Macros: { href: "{}" } },
        messageStyle: "none"
    }); 
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  
<a id="gotop" href="#">   
  <span>▲</span> 
</a>

<script src="//hahack-1253537070.file.myqcloud.com/images/blog/js/jquery.imagesloaded.min.js"></script>
<script src="//hahack-1253537070.file.myqcloud.com/images/blog/js/bootstrap.min.js"></script>
<script src="//hahack-1253537070.file.myqcloud.com/images/blog/js/jquery.tableofcontents.min.js"></script>
<script src="//hahack-1253537070.file.myqcloud.com/images/blog/js/tocgenerator.min.js"></script>
<script src="//hahack-1253537070.file.myqcloud.com/images/blog/js/main.js"></script>
<script src="//hahack-1253537070.file.myqcloud.com/images/blog/js/fadetoc.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="//hahack-1253537070.file.myqcloud.com/images/blog/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = '/' + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>



  <script type="text/javascript">
    $(document).ready(function() {
      
         $("#freemind-cerulean").click(function(){
           document.cookie = "theme=cerulean; domain=www.hahack.com; maxAge=0";
           document.cookie = "theme=cerulean; domain=www.hahack.com";
           $("#theme").attr("href", "/css/themes/cerulean.css");
         });
      
         $("#freemind-cyborg").click(function(){
           document.cookie = "theme=cyborg; domain=www.hahack.com; maxAge=0";
           document.cookie = "theme=cyborg; domain=www.hahack.com";
           $("#theme").attr("href", "/css/themes/cyborg.css");
         });
      
         $("#freemind-paper").click(function(){
           document.cookie = "theme=paper; domain=www.hahack.com; maxAge=0";
           document.cookie = "theme=paper; domain=www.hahack.com";
           $("#theme").attr("href", "/css/themes/paper.css");
         });
      
         $("#freemind-flatly").click(function(){
           document.cookie = "theme=flatly; domain=www.hahack.com; maxAge=0";
           document.cookie = "theme=flatly; domain=www.hahack.com";
           $("#theme").attr("href", "/css/themes/flatly.css");
         });
      
         $("#freemind-journal").click(function(){
           document.cookie = "theme=journal; domain=www.hahack.com; maxAge=0";
           document.cookie = "theme=journal; domain=www.hahack.com";
           $("#theme").attr("href", "/css/themes/journal.css");
         });
      
         $("#freemind-simplex").click(function(){
           document.cookie = "theme=simplex; domain=www.hahack.com; maxAge=0";
           document.cookie = "theme=simplex; domain=www.hahack.com";
           $("#theme").attr("href", "/css/themes/simplex.css");
         });
      
         $("#freemind-spacelab").click(function(){
           document.cookie = "theme=spacelab; domain=www.hahack.com; maxAge=0";
           document.cookie = "theme=spacelab; domain=www.hahack.com";
           $("#theme").attr("href", "/css/themes/spacelab.css");
         });
      
     });
  </script>



<script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>